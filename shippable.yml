# configure the project language, language version, and Django enviornment
language: python
python: 2.7
env: DJANGO_VERSION=1.8.3

# include postgres for tests
services:
  - postgres

# install libjpeg to prevent Pillow installation from failing in the minion
# and create database needed for testing
# TODO figure out what this is and we need it
before_install:
  - sudo apt-get install libjpeg-dev
  - psql -c 'CREATE ROLE shippable WITH superuser;' -U postgres -h localhost
  - psql -c 'CREATE DATABASE postgres;'
  - psql -c 'CREATE DATABASE snapdb;' -U postgres -h localhost

# install requirements
install: 
  - pip install -r requirements.txt

# command to run tests
script:
  - coverage run manage.py test --settings=snap.settings.local --parallel
  - coverage html --fail-under=55 --title="Snap Coverage report"

integrations:
  notifications:
    - integrationName: email
      type: email
      recipients:
        - dylan@rightcallconsulting.com
        - sam@rightcallconsulting.com
      branches:
        only:
          - master
          - develop
    - integrationName: Shippable-Slack
      type: slack 
      recipients:
        - "#devops"