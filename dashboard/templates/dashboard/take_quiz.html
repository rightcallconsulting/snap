{% extends 'dashboard/base.html' %}
{% load staticfiles %}

{% block content %}
	<div id="take-quiz" class="take-quiz">
		<div id="display-box" class="col-md-8 bordered-div">
			<div id="header-box" class="static-header display-header">
				{{ quiz.name }}
			</div>

			<div id="quiz-box">
			</div>

			<div class="mainview-buttons">
				<button id="submit-quiz-button" name="button">
					<i class="fa fa-pencil-square-o fa-2x mainview-button-icon" title="Submit Quiz"></i>
				</button>

				<button id="check-answer-button" name="button">
					<i class="fa fa-check fa-2x mainview-button-icon" title="Check answer"></i>
				</button>

				<button id="skip-question-button" name="button">
					<i class="fa fa-step-forward fa-2x mainview-button-icon" title="Skip question"></i>
				</button>
		
				<button id="zoom-in-button" name="button">
					<i class="fa fa-search-plus fa-2x mainview-button-icon" title="Zoom in"></i>
				</button>
		
				<button id="zoom-out-button" name="button">
					<i class="fa fa-search-minus fa-2x mainview-button-icon" title="Zoom out"></i>
				</button>
			</div>
		</div>

		<div id="sideview" class="col-md-3">
			<div id="sideview-header"> Questions </div>
			<div id="sideview-buttons"></div>
		</div>

	<div id="test-id" test-id="{{test.id}}" style="display: none;"></div>
	<div id="team-id" team-id="{{team.id}}" style="display: none;"></div>
	<div id="player-id" player-id="{{player.id}}" style="display: none;"></div>
{% endblock %}

{% block javascript %}
	<script src="{% static 'dashboard/js/jquery-1.10.2.min.js' %}"></script>
	<script type="text/javascript">
		var quiz;
		var attempt;

		//*******************************************************************//
		// p5.js Animation Functions                                         //
		//*******************************************************************//

		function setup() {
			var display_box = document.getElementById("display-box");
			var display_box_header = display_box.querySelector(".display-header");
			var display_box_footer = display_box.querySelector(".mainview-buttons");
			var sideview = document.getElementById("sideview");
			var height = sideview.offsetHeight - (display_box_header.offsetHeight + display_box_footer.offsetHeight);
			
			// 4px is the combined size of the borders on either side. What is a better way to do this?
			var width = display_box.offsetWidth - 4; 

			// Create canvas and add it to the main view
			var quiz_box_div = document.getElementById("quiz-box");
			var myCanvas = createCanvas(width, height);

			field.height = height;
			field.width = width;
			field.heightInYards = 35;
			field.ballYardLine = 65;
			background(58, 135, 70);

			myCanvas.parent("quiz-box");

			// Create quiz and load it's content from Json.
			quiz = new Quiz({});
			quiz.name = '{{ quiz.name }}';
			quiz.unit = '{{ quiz.unit }}';

			var formationJsonFromDatabase = "";
			{% for formation in quizFormations %}
			formationJsonFromDatabase = '{{ formation.formationJson|safe }}';
			quiz.createFormationFromJson(JSON.parse(formationJsonFromDatabase));
			{% endfor %}
			
			var playJsonFromDatabase = "";
			{% for play in quizPlays %}
			playJsonFromDatabase = '{{ play.playJson|safe }}';
			quiz.createPlayFromJson(JSON.parse(playJsonFromDatabase));
			{% endfor %}
			
			var conceptJsonFromDatabase = "";
			{% for concept in quizConcepts %}
			conceptJsonFromDatabase = '{{ concept.conceptJson|safe }}';
			quiz.createConceptFromJson(JSON.parse(conceptJsonFromDatabase));
			{% endfor %}

			quiz.buildQuestions("X");

			window.onresize = function() {
				var display_box = document.getElementById("display-box");
				var display_box_header = display_box.querySelector(".display-header");
				var display_box_footer = display_box.querySelector(".display-buttons");
				var sideview = document.getElementById("sideview");
				var height = sideview.offsetHeight - (display_box_header.offsetHeight + display_box_footer.offsetHeight);
				var width = display_box.offsetWidth - 4;

				resizeCanvas(width, height);
				field.height = height;
				field.width = width;
				
				resizeMainViewObjects();
			};

			drawOpening();
		};

		function draw() {
			// Draw opening
			drawOpening();
		};

		function drawOpening() {
			field.drawBackground(quiz, height, width);
			quiz.draw(field);

			fill(176,176,176);
		};

		//*******************************************************************//
		// p5.js Event Listeners                                             //
		//*******************************************************************//
		
		function mousePressed() {};

		function mouseDragged() {};

		function mouseReleased() {};

		function keyPressed() {};

		function keyTyped() {};

		//*******************************************************************//
		// jQuery Event Listener Functions                                   //
		//*******************************************************************//

		$("#submit-quiz-button").click(function(event) {
			quiz.submit();
		});

		$("#check-answer-button").click(function(event) {
			var question_index = quiz.getCurrentQuestionIndex();

			quiz.checkCurrentQuestion();
		});

		$("#skip-question-button").click(function(event) {
			var question_index = quiz.getCurrentQuestionIndex();

			quiz.skipCurrentQuestion();
		});

		$("#zoom-in-button").click(function(event) {
			var heightInYards = field.heightInYards;
			var widthInYards = field.heightInYards * field.width / field.height;
			
			if(heightInYards > 25) {
				field.heightInYards -= 5;
			} else {
				field.heightInYards = 20;
			}

			resizeMainViewObjects();
		});

		$("#zoom-out-button").click(function(event) {
			var heightInYards = field.heightInYards;
			var widthInYards = field.heightInYards * field.width / field.height;
			
			if(heightInYards > 50) {
				field.heightInYards = 55;
			} else {
				field.heightInYards += 5;
			}

			resizeMainViewObjects();
		});

		function updateMainviewAndSideview() {};

		// resizeMainViewObjects resizes all of the buttons and bars in our
		// main view. It is called when the user resizes their browser.
		function resizeMainViewObjects() {};
	</script>
{% endblock %}
