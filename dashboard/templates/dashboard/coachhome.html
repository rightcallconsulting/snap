{% extends 'dashboard/base.html' %}
{% load staticfiles %}
{% load app_filters %}

{% block content %}
	<div class="coach-home">
		<div class="content-container">
			<div class="coach-button-container col-md-12">
				<a id="create-formation-link" href="/formations/create">
					<p>CREATE<br>FORMATION</p>
				</a>
				<a id="create-play-link" href="/plays/create">
					<p>CREATE<br>PLAY</p>
				</a>
				<a id="create-concept-link" href="/concepts/create">
					<p>CREATE<br>CONCEPT</p>
				</a>
				<a id="create-quiz-link" href="/quizzes/create">
					<p>CREATE<br>QUIZ</p>
				</a>
				<a id="groups-link" href="/groups/create">
					<p>CREATE<br>GROUP</p>
				</a>
			</div>
			<div class="col-md-7 no-border">
				<div class="dash-col">
					<div class="dash-header">
						<span><h4>ANALYTICS</h4></span>
					</div>
					{% if analytics %}
						<div class="analytics-graph-row">
							<table class="analytics-table">
								<tbody>
									<tr>
										<td>
											<canvas id="percentCorrectChart"></canvas>
											<br />
											<span>CORRECT</span>
										</td>
										<td>
											<canvas id="percentIncorrectChart"></canvas>
											<br />
											<span>MISSED</span>
										</td>
										<td>
											<canvas id="percentSkippedChart"></canvas>
											<br />
											<span>SKIPPED</span>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
				</div>

					<div class="analytics-table-row">
						<div class="table-header">
							<span>PLAY ALERTS</span>
						</div>
						<table class="alerts-list">
							<tbody>
								<tr>
									<th>PLAY</th>
									<th>CORRECT %</th>
								</tr>
								{% for play, percentage in alarms.items %}
									<tr>
										<td>
											{{play}}
										</td>
										<td>
											{{percentage}}%
										</td>
									</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				{% endif %}
			</div><!--/col-md-6-->
			<div class="col-md-5 no-border">
				<div class="secondary-content-area top no-border">
					<div class="dash-header">
						<span>
							<h4>
								QUIZZES
							</h4>
						</span>
					</div>
					<table class="table homepage-quiz-table" id="responsiveTable">
						<thead>
							<tr>
								<th>QUIZ</th>
								<th>DUE</th>
								<th>STATUS</th>
							</tr>
						</thead>
						<tbody>
							{% for test in uncompleted_tests %}
								{% if forloop.counter0 < 2 %}
									<tr id="test-{{test.id}}">
										<td>
											{{test.name}}
										</td>
										<td>
											{% due_date_default test.deadline %}
										</td>
										<td>
											<span class="status-complete">COMPLETE</span>
										</td>
									</tr>
								{% endif %}
							{% endfor %}
						</tbody>
					</table>
				</div>
				<div class="secondary-content-area bottom">
					<div class="dash-header">
						<span><h4>NEWS FEED</h4></span>
					</div>
					<div class="non-scrollable-table-wrapper">
						<table class="table news-feed-table">
							<tbody>
								{% for test in uncompleted_tests %}
									{% if forloop.counter0 < 1 %}
										<tr>
											<td>
												<img class="test-row-icon" src="{% static 'dashboard/images/playbook-icon-dark.png' %}" alt="">
											</td>
											<td>
												<a class="coach-link" href="#">
													{{test.coach_who_created.first_name}} {{test.coach_who_created.last_name}}
												</a>: Added a new 
												<a class="play-link" href="#">
													PLAY
												</a>
											</td>
										</tr>
										<tr>
											<td>
												<img class="test-row-icon" src="{% static 'dashboard/images/formation-icon-dark.png' %}" alt="">
											</td>
											<td>
												<a class="coach-link" href="#">
													{{test.coach_who_created.first_name}} {{test.coach_who_created.last_name}}
												</a>: Added a new 
												<a class="formation-link" href="#">
													FORMATION
												</a>
											</td>
										</tr>
									{% endif %}
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div><!--/col-md-6-->
		</div><!--/content-container-->
	</div><!--/coach-home-->
{% endblock %}

{% block javascript %}
	<script>
		var clickButton = function(index){
			var links = ["/quiz/create_formation", "/quiz/create_play", "/quizzes/create", "/groups", "/analytics"];
			if(index >= 0 && index < links.length){
				window.location.href = links[index];
			}
		};
	</script>

	<!-- Pass Django variables to JS assets -->
	<script type="text/javascript">
		var percentCorrect = {{analytics.total_correct_attempts_percentage}},
		percentIncorrect = {{analytics.total_incorrect_attempts_percentage}},
		percentSkipped = {{analytics.total_skipped_attempts_percentage}};
	</script>

	<!-- Loading Chart.js through CDN for now -->
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>

	<!-- Build Charts -->
	<script src="{% static 'dashboard/js/analytics.js' %}"></script>

	<script type="text/javascript">
		window.onresize = function(){
			makeChart(percentCorrect, colors.correct, 'percentCorrectChart');
			makeChart(percentIncorrect, colors.incorrect, 'percentIncorrectChart');
			makeChart(percentSkipped, colors.skipped, 'percentSkippedChart');
		}
	</script>
{% endblock %}
